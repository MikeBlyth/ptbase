- patient = @visit.patient
%fieldset
  %legend= "Current information for #{patient_name_link(patient)}".html_safe
  = render(:partial => '/shared/medinfo', :object => patient, as: :patient)
= render(:partial => 'shared/problem_list', :object => patient )
= simple_form_for @visit, {url: {patient_id: patient.id}} do |form|
  %fieldset
    %legend Visit info
    = form.input :date, as: :string
    = form.input :scheduled, label: 'Scheduled visit?'
    = form.input :next_visit, as: :string, label: 'Next visit (add js buttons to give choices)'
    = form.association :provider
    = form.input :newpt, label: 'New patient?'
    = form.input :adm, label: 'Admitted?'

  %fieldset
    %legend Vital Signs
    = form.input :weight
    = form.input :height
    = form.input :head_circ
    = form.input :mid_arm_circ
    = form.input :temperature
    = form.input :resp_rate
    = form.input :heart_rate
    = form.input :sbp
    = form.input :dbp

  %fieldset
    %legend Signs and Symptoms
    = check_boxes(@visit, :symptoms)

  %fieldset
    %legend History
    = form.input :hpi, label: "History of present illness"
  %fieldset
    %legend Physical Exam
    %p.form_instruction Tick box if this part of exam is normal.
    = check_boxes(@visit, :physical)
    %br
    = text_area 'visit', 'phys_exam', {:rows => '1', :cols => '70' }
  %fieldset
    %legend Assessment and Diagnosis
    = check_boxes(@visit, :diagnoses)
    = form.input :dx, label: 'Other diagnoses'
    = form.input :newdx, label: 'New diagnosis given?'
    %br
    = form.input :assessment_stable, label: "Stable"
    = form.input :assessment_oi, label: "Active OI"
    = form.input :assessment_drug_toxicity, label: "Drug toxicity"
    = form.input :assessment_nonadherence, label: "Nonadherence"
    = form.input :assessment
  %fieldset
    %legend Other
    = form.input :development
    = form.input :diet_breast
    = form.input :diet_breastmilk_substitute
    = form.input :diet_pap
    = form.input :diet_solids

    = form.input :meds
    = form.input :plan
    = form.input :comments

    = form.input :anti_tb_status
  %fieldset
    %legend HIV related
    = form.input :hiv_stage
    = form.input :arv_status
    = form.input :arv_missed
    = form.input :arv_missed_week
    = render(:partial => 'arv_regimen', object: @visit )
  %hr
  = form.error :base
  = form.submit
  = link_to "Cancel", request.referer
%p Add JS validation for HIV pts

